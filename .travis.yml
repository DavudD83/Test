language: android
jdk: oraclejdk8
env:
  global:
  - ANDROID_TARGET=android-22
  - ANDROID_ABI=armeabi-v7a
  - BUILD_TOOLS-VERSION=24.0.2
  - BUILD_TOOLS=build-tools-${BUILD-TOOLS-VERSION}
  - APK_PATH=$HOME/android/creative_assistant_t${TRAVIS_BUILD_NUMBER}
  - secure: oGKa1NQLb4h+1eGMju38ON5S3Y8Ko8tj/dG2Q5tmGGdMGaHwyU5H6+0ih7H35VCXOgPLpACYHt63saCwqDWTV6hqEzLBhgzoUT0qQHTorDm9bzSP1h9tXeDD81ezE5hTS3Lzc0rj7qYq07u8KXWiIYM+Njn+83JHV+tmPhiS8xRlPFxTlVHyRWMYDicJ73P/N863we8SbKFNQBY8avJ34b8WG4EcMxCgZYwiAtyAlkUJ5I92YyH9CYdpWDsgOI3MACxQ3qEzOit8xV5ABQUhcNaOKLsOzREouy2RjirZfuSfV3N4H2/JAWfepTr9o6sYJgaLG36dfHn7IHc/anSPQAJSLzN8SM8crdMqYn19rmBYA2oQ0Ieb1HGYlyAPtoYaw55KJGbO1+RmA+F1ydVtiMJPe4YJGNndMe6Hk9Udk1AVzfFqCqBLROLFA3p4MPIONdusLNLPr/062iXUrDIk4CbsQGlCnojekghzIoI88PaRjIRDXdNl/DqOO8XcMfJEGHMABypYlOIh9s7nfJBsPyge+BksvLfaNV19257KLuVTp+wVnWyUFeHvlUWJ5NISVxk8vqlnTgTNAVHJenz1JwHn5AEhLBtd7AM06gnkUEsnfvll1YG0vDwLOptqrlVxtjP4BbKdSuFmApvmwy9pvzHHaGlNHPYA2eRb1hGHwHg=
  - secure: oLbU4RrA+NPyL7x/vI3OyutlwL/O42K9W7dktodf7fZg3lre8C0H/2NVP1kM4dXUaT/rVL+XI/akZXyxXB9xYjZY4rO+lijJPRnR17uy/10E4D+YYiBLdEq2Dnb3WIpkmz+5noJmTO+zDDIDRSSdH0Z6HjxdyWOzckOZaVDkAiU+w07KfbSxVHc25nYUMX5yIkW6SmgOmj7KQb5zj9p8d9bPxb0o0veReu+qtFzBT3fkROMQT1El7qOIsl5wlditjJZ4ugAaB+MbNZI2dPwix6BlXc1e2mDPfII+LyjDy/veMcl0wcYAFtgmBNqelZXaXd4F4GrhIZVzRXj3I8iMYYdLfYdBNGl8X0qc7XTUctbxfsA31lTgmir5n3axCBi1OUBvyri8RvUVn+V8qoxb6e++wPclxHJhtZ0aZycn+Dx2q31IQehqmQdBi5lpMDR9yPkDhoryfaF3PXc95WdUZiLSryEpH6ieHVucJwov7ir57MPOBwylDCftys00LkWl4mE+41MgN02dhmKOW5SRRH1oO/8tiqQj70/v6pxI5XgqWlfcyISH0RhyC86BvHV9NxyYHjLWf3zFJn0FxOw/ZC85b2TfO+nrfAN3lsMg+zeQy+omA3AvfO9419g5L2W9QKs5Ju7zfmqlQnNdMiHUhpHJTktRq+V/HS1S1DAxL9U=
android:
  components:
  - tools
  - platform-tools
  - build-tools-24.0.2
  - android-24
  - android-22
  - extra-android-m2repository
  - sys-img-${ANDROID_ABI}-${ANDROID_TARGET}
  licenses:
  - android-sdk-preview-license-.+
  - android-sdk-license-.+
  - google-gdk-license-.+
before_cache:
- rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
before_script:
- echo no | android create avd --force -n test -t ${ANDROID_TARGET} --abi ${ANDROID_ABI}
- emulator -avd test -no-audio -no-window &
- android-wait-for-emulator
- adb shell input keyevent 82 &
script:
- "./gradlew build connectedCheck"
before_deploy:
- jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 app/build/outputs/apk/app-release-unsigned.apk
  creative_client_test -keystore $TRAVIS_BUILD_DIR/.keystore -storepass $storepass
  -keypass $keypass
- "${ANDROID_HOME}/build-tools/24.0.2/zipalign 4 app/build/outputs/apk/app-release-unsigned.apk
  ${APK_PATH}"
deploy:
  provider: releases
  api_key:
    secure: bXO6mpQgTWt5c1ZW4F8kX3Qfg5o6aW88EQWurUGE7hE8WgCkkAhsw2tSGkjNuqkIqGMsYSKEZFl7+8+nQdyZK8NbJkMCWmY3iElmNMZct/1Fyx3eu2zDTwCYLRIQXDODPo1jcJ964j9CKSzjbNuvzFGxeV2YXZRf+6MMG4RPzP3rN3iM8Ta6iv3mWe49rWNj9RTjfXX0oBW2Sy7lzWQ0o4ttLt6s9MX2b9AE63CKnu8ewVV5Vd/xZ1olcvNWPsBRB6PcqrTzveFtX6tDGeV8XEkhphXyJsn9Z7ROt1BGPI9XkmqcVFQxua5J7sT+M8YAeAFqdH1LCR3892/+t09enBrufSRyITvXCGwTtHD42WHCbUkcs5qj+jY8yV+SaN7X7YyxTWSKW6ZGrzp49dWfhHu4sUF3hyz1X10RrOzWSJKFsQ1cg8WpQCu8vt9S7+tkFOvusQ2bvyTtoGG1V3r0SZKFB9hNmL2+78bOLDJrkFBksy46dtjCkGys+oYLnHCJbKKKKdirE9xXtut0ANpB2+QhPYrIlb1jEmnMQY7mlQWDCNkupm06oRX+cQSkdcScCVjiGHtl+tylY6C++7DeR02yFBTZM7Dm74cB51IwqeUZwsOPU2p+ov8ucDEw5pfHdNUJZD6SCG+pNhszgjjEmsT9v4vT2eDEBvKnnBB7gRs=
  file: "${APK_PATH}"
  file_glob: 'true'
  skip_cleanup: true
  on:
    repo: dot-cat/shp_android_clients
    branch: travis_ci
before_install:
- openssl aes-256-cbc -K $encrypted_c57facf09bea_key -iv $encrypted_c57facf09bea_iv
  -in .keystore.enc -out .keystore -d
